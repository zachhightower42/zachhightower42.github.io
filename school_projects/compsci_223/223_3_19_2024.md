# 223 Test 2
#223_test_2
Go over homework 7 for the test, will have a similar section on the exam



# Function (Procedure) Call in HL
Passing Control
- To beginning of procedure code
- Back to return point
Passing Data
- Procedure arguments
- Return value
Managing data (storage)
- Allocate during procedure execution
- Deallocate upon return

As the function is called, we create memory space for local variables, and upon function return, we destroy or wipe the memory space for local variables. 

# Passing control
Procedure call: `call label`
- Push return address on stack
- Jump to `label`
	Return address:
	- Address of the next instruction right after call
	- Example on next heading
Procedure return: `ret`
- Pop address from stack
- Jump to address

Stack - LIFO (last in first out)

# Call Chain Example
(see slides)

Top of stack is at lowest memory address, bottom of stack is at highest memory address

Function inlining 
eliminate the function code, just directly execute the body of the function. This removes the overhead of allocating before and deleting afterward the space for local variables. 

# Passing control (cont)
We store the return address on stack

Return address where we need to put the return value (the actual value that we've calculated or found using the function)

# Contents
	Return information
	Local storage (if needed)
		Including function arguments
	Temporary space (if needed)
	Registers saved
	Old %ebp


# Passing data

64 bit x86
- First 5 arguments are passed via registers
- The rest are passed via stack memory
32 bit x86
- All are passed via stack memory
Return value is passed via
- %rax (64 bit)
- %eax (32 bit)
This rule is called *calling convention*

# Managing data

Functions have their local data such as local variables arrays etc

Local data is alive (or valid) while the function is 

# Stack memory
Region of memory managed with stack discipline (FILO)

It grows toward lower memory addresses

The register %rsp contains the address of the top of the stack (lowest address) It is called the 'top' because it has the address of the top element

Register of %rbp contains the address of the bottom of the current stack frame

# Stack frame
- Stack memory consist of stack frames (aka activation records) each of which corresponds to a call to a function which has not yet terminated with a return
- Used to support a function call 

